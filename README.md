# SQL-Repeatabler
This tool changes SQL-Scripts, which are generated by lo-code platform 'Appian', to MS flavour and makes them runnable repeatedly.

I.e. a 'create table' script should not generate a 'table already exists' error when running the second time.

The converted scripts are intended to be used in a deployment system that wants to execute them more than once.

This tool only covers those commands that Appian has confronted us with so far. ItÂ´s only a quick hack but saves lot of time.

Examples:

| Input                                                        | Output                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| create table [DB_FOO] (<br />[ID] int identity not null,<br />[FIELD_FOO_1] nvarchar(255),<br />[FIELD_FOO_2] int,<br />[FIELD_FOO_3] datetime,<br />primary key ([ID])<br />); | IF OBJECT_ID(N'[dbo].[DB_FOO]', 'U') IS NULL<br />BEGIN<br />create table [dbo].[DB_FOO] (<br />[ID] int identity not null,<br />[FIELD_FOO_1] nvarchar(255),<br />[FIELD_FOO_2] int,<br />[FIELD_FOO_3] datetime,<br />primary key ([ID])<br />);<br />END; |
| alter table [DB_FOO]<br />add [FIELD_1] nvarchar(255);<br />add [FIELD_2] datetime;<br />modify column [FIELD_3] nvarchar(255);<br />add [FIELD_4] tinyint; | IF COL_LENGTH ('DB_FOO','FIELD_1') IS NULL<br />BEGIN<br />ALTER TABLE [DB_FOO]<br />ADD [FIELD_1] nvarchar(255);<br />END;<br />IF COL_LENGTH ('DB_FOO','FIELD_2') IS NULL<br />BEGIN<br />ALTER TABLE [DB_FOO]<br />ADD [FIELD_2] datetime;<br />END;<br />ALTER TABLE [DB_FOO]<br />ALTER COLUMN [FIELD_3] nvarchar(255);<br />IF COL_LENGTH ('DB_FOO','FIELD_4') IS NULL<br />BEGIN<br />ALTER TABLE [DB_FOO]<br />ADD [FIELD_4] tinyint;<br />END; |
| SET IDENTITY_INSERT DB_FOO ON;<br />INSERT INTO TABLE_FOO (ID, FIELD_1, FIELD_2, FIELD_3) VALUES<br />(1, 'ROW_1_FIELD_1', 'ROW_1_FIELD_2', 'ROW_1_FIELD_3'),<br />(1, 'ROW_2_FIELD_1', 'ROW_2_FIELD_2', 'ROW_2_FIELD_3'),<br />(1, 'ROW_3_FIELD_1', 'ROW_3_FIELD_2', 'ROW_3_FIELD_3')<br />SET IDENTITY_INSERT DB_FOO OFF; | if (select COUNT(*) from DB_FOO where ID=1)=0<br />Begin<br />SET IDENTITY_INSERT DB_FOO ON;<br /> INSERT INTO [dbo].[DB_FOO](ID, FIELD_1, FIELD_2, FIELD_3) VALUES<br />(1, 'ROW_1_FIELD_1', 'ROW_1_FIELD_2', 'ROW_1_FIELD_3')<br />SET IDENTITY_INSERT DB_FOO OFF;<br />End<br />if (select COUNT(*) from DB_FOO where ID=1)=0<br />Begin<br />SET IDENTITY_INSERT DB_FOO ON;<br /> INSERT INTO [dbo].[DB_FOO](ID, FIELD_1, FIELD_2, FIELD_3) VALUES<br />(1, 'ROW_2_FIELD_1', 'ROW_2_FIELD_2', 'ROW_2_FIELD_3')<br />SET IDENTITY_INSERT DB_FOO OFF;<br />End |

